pipeline {
    agent any
    environment {
        AWS_ACCESS_KEY_ID = credentials('AWS_ACCESS_KEY_ID')
        AWS_SECRET_ACCESS_KEY = credentials('AWS_SECRET_ACCESS_KEY')
        AWS_DEFAULT_REGION = "us-east-1"
    }
    parameters {
        choice(name: 'ACTION', choices: ['create', 'delete'], description: 'Choose action to perform on the cluster')
    }

    stages {
        stage("Manage EKS Cluster") {
            steps {
                script {
                    dir('cluster') {
                        if (params.ACTION == 'create') {
                            sh "terraform init"
                            sh "terraform apply -auto-approve"
                        } else if (params.ACTION == 'delete') {
                            echo "Cluster deletion is not supported in this pipeline."
                        } else {
                            error "Invalid action specified."
                        }
                    }
                }
            }
        }
    }
}
